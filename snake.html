<html>
    <head>
        <title>The Snake Game</title>
    </head>

    <body>
        <center>
            <h1>The Snake Game</h1>
        </center>
        <center>
            <canvas id="sketch" width="800" height="600" style="border: 1px solid black;">
            </canvas>
        </center>

        <script id="lib">
         let canvas = document.getElementById("sketch");
         let ctx = canvas.getContext("2d");

         let Board = {
             width: canvas.width,
             height: canvas.height,
             rows: 60,
             cols: 80
         };

         let Cell = {
             width: (Board.width / Board.cols),
             height: (Board.height / Board.rows)
         };

         function gridLoop(rows, cols, row_fn, row_col_fn) {
             for(let row=0; row < rows; row++) {
                 if(row_fn) row_fn(row);

                 for(let col=0; col < cols; col++) {
                     row_col_fn(row, col);
                 }
             }
         }

         function emptyGrid() {
             let aGrid = [];

             gridLoop(Board.rows, Board.cols,
                      (row) => {
                          aGrid[row] = [];
                      },
                      (row, _) => {
                          aGrid[row].push(0);
                      }
             );

             return aGrid;
         }

         function clearBoard(grid) {
             gridLoop(Board.rows, Board.cols, null, (row, col) => {
                 grid[row][col] = 0;
             });
         }

         function scale(row, col) {
             let x = Cell.width * col;
             let y = Cell.height * row;

             return [x, y];
         }

         function drawCell(row, col, cell) {
             let [x, y] = scale(row, col);

             if (cell == 0) {
                 ctx.clearRect(x, y, Cell.width, Cell.height);
             } else {
                 ctx.fillRect(x, y, Cell.width, Cell.height);
             }
         }

         function drawBoard(grid) {
             gridLoop(Board.rows, Board.cols, null, (row, col) => {
                 drawCell(row, col, grid[row][col]);
             });
         }

         function placeObject(startRow, startCol, grid, obj) {
             for ([row, col] of obj) {
                 grid[startRow+row][startCol+col] = 1;
             }
         }

         function growSnake() {
             head = snake.body[snake.body.length - 1];
             row = head[0];
             col = head[1];

             if (snake.dir == 'right') {
                 col =  head[1] + 1;
                 if (col >= Board.cols) {
                     col = 0;
                 }
             } else if (snake.dir == 'left') {
                 col = head[1] - 1;
                 if (col < 0) {
                     col = Board.cols - 1;
                 }
             } else if (snake.dir == 'up') {
                 row = head[0] - 1;
                 if (row < 0) {
                     row = Board.rows - 1;
                 }
             } else if (snake.dir == 'down') {
                 row = head[0] + 1;
                 if (row >= Board.rows) {
                     row = 0;
                 }
             }
             snake.body.push([row, col]);
         }

         function moveSnake(snake) {
             growSnake(snake);
             snake.body.shift();
         }

         window.addEventListener('keydown', changeDir, false);

         function changeDir(e) {
             if (e.keyCode == '38' && snake.dir != "down") {
                 snake.dir = "up";
             } else if (e.keyCode == "40" && snake.dir != "up") {
                 snake.dir = "down";
             } else if (e.keyCode == "37" && snake.dir != "right") {
                 snake.dir = "left";
             } else if (e.keyCode == "39" && snake.dir != "left") {
                 snake.dir = "right";
             }
         }

        </script>

        <script id="main">
         let grid = emptyGrid();
         let snake = {
             body: [[0,0], [0,1], [0,2]],
             dir: 'right',
         };

         placeObject(0, 0, grid, snake.body);
         drawBoard(grid);

         setInterval(() => {
             clearBoard(grid);

             moveSnake(snake);
             placeObject(0, 0, grid, snake.body);

             drawBoard(grid);
         }, 500);
        </script>
    </body>
</html>
